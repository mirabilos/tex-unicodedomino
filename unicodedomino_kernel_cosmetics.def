% -*- mode: tex -*-
%-
% See unicodedomino.sty for copyright and licence terms. Furthermore
% this file is dual-licenced under the LPPL version 1.3c or later.
%-
% Improve error and warning formatting. Fully submitted upstream.

%: https://github.com/latex3/latex2e/pull/82
\ifx\UTFviii@hexbyte\@undefined%
 % format a number as two-digit hex
 \gdef\UTFviii@hexbyte#1{%
  \ifnum#1<16 0\fi%
  \UTFviii@hexnumber{#1}%
 }%

 % override message to give the byte in hex
 \def\UTFviii@invalid@err#1{%
  \PackageError{inputenc}{Invalid UTF-8 byte "\UTFviii@hexbyte{`#1}}%
   \UTFviii@invalid@help%
 }%
\fi%

%: reverted partially, override bogus definition
% format a number as Unicode codepoint hex
\gdef\UTFviii@hexcodepoint#1{%
 \ifnum#1<16 U+000%
 \else\ifnum#1<256 U+00%
 \else\ifnum#1<4096 U+0%
 \else\ifnum#1<65536 U+%
 \else\ifnum#1<1048576 U-000%
 \else U-00%
 \fi\fi\fi\fi\fi%
 \UTFviii@hexnumber{#1}%
}%

%: https://github.com/latex3/latex2e/pull/62 (rejected)
% split an invalid byte sequence for output
\ifx\UTFviii@splitseq\@undefined%
 \gdef\UTFviii@splitseq#1:#2\relax{%
  \UTFviii@hexseq#2\relax%
 }%
 \gdef\UTFviii@hexseq#1#2\relax{%
  % display first octet
  \space "\UTFviii@hexbyte{`#1}%
  % recursively handle remaining octets
  \ifx\relax#2\relax\else\UTFviii@hexseq#2\relax\fi%
 }%
\fi%
